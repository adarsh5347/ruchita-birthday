<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Happy Birthday Ruchitaaa üéâüíô</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Happy Birthday Ruchita ‚Äî photos, videos, a mini Tower of Hanoi game and daily quotes." />
  <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --color-primary:#1e90ff;
      --color-secondary:#4da6ff;
      --color-background:#e0f2ff;
      --color-text:#1e2a40;
      --color-gold:#FFD700;
      --color-gold-bg:#fff8e1;
      --color-motivation:#d9ead3;
      --color-peg-wood:#8B4513;
      --color-base-wood:#A0522D;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Poppins',sans-serif;
      color:var(--color-text);
      background:linear-gradient(135deg,var(--color-background),#c2e0ff);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
    }
    header{
      text-align:center;
      padding:3.5rem 1rem;
      background:linear-gradient(135deg,var(--color-secondary),var(--color-primary));
      color:white;
      position:relative;
      overflow:hidden;
      border-bottom-left-radius:30px;
      border-bottom-right-radius:30px;
      box-shadow:0 6px 15px rgba(0,0,0,0.25);
    }
    @media (prefers-reduced-motion: no-preference) {
      header { animation: pulse-border 2s infinite alternate; }
      @keyframes pulse-border { from { border-color: rgba(255,255,255,0.5); } to { border-color: rgba(255,255,255,1); } }
    }
    header h1{ font-family:'Gochi Hand',cursive; font-size:clamp(2.5rem,8vw,4rem); margin:0; text-shadow:0 4px 8px rgba(0,0,0,0.35);}
    header p{ font-size:clamp(1rem,3vw,1.2rem); margin-top:.5rem; opacity:.95;}

    /* Canvas confetti container */
    .confetti-canvas {
      position:absolute;
      left:0; top:0;
      width:100%; height:100%;
      pointer-events:none;
    }

    main{max-width:1100px;margin:2rem auto;padding:0 1rem;}
    section{
      background:#fff;
      padding:2.5rem;
      border-radius:20px;
      box-shadow:0 10px 30px rgba(0,0,0,0.12);
      margin-bottom:1.5rem;
      transition:transform .25s ease;
    }
    section:hover{ transform: translateY(-4px); }
    section h2{ text-align:center; color:var(--color-primary); margin-bottom:1rem; font-weight:700; font-size:1.6rem}

    /* Memory wall grid */
    #preview{ display:grid; grid-template-columns: repeat(auto-fill,minmax(180px,1fr)); gap:15px; justify-items:center; margin-top:1rem; }
    .media-item{ width:100%; max-width:220px; height:140px; overflow:hidden; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.18); cursor:pointer; border:2px solid var(--color-secondary); display:flex; align-items:center; justify-content:center; background:#fafafa;}
    .media-item img, .media-item video{ width:100%; height:100%; object-fit:cover; display:block; }
    @media (max-width:600px){ .media-item{ max-width:45%; height:120px;} }
    .media-item:focus{ outline:3px solid rgba(30,144,255,0.35); outline-offset:3px; }

    /* Videos container */
    #videoEmbedsContainer { display:flex; flex-direction:column; gap:22px; align-items:center; margin-top:10px;}
    .video-wrapper { width:100%; max-width:640px; border-radius:12px; overflow:hidden; box-shadow:0 8px 16px rgba(0,0,0,0.18); aspect-ratio:16/9; background:#111; display:flex; align-items:center; justify-content:center;}
    .video-placeholder { color:#fff; font-weight:600; cursor:pointer; user-select:none; padding:8px 12px; text-align:center;}
    .video-placeholder:focus{ outline:3px solid rgba(255,215,0,0.25); outline-offset:3px; }

    /* Thank you note */
    .thank-you-note { background:var(--color-gold-bg); border:3px solid var(--color-gold); padding:1.75rem; border-radius:14px; text-align:center; box-shadow:0 6px 15px rgba(255,215,0,0.12);}
    .favourite-terms-list{ text-align:left; padding:0 1rem; list-style:none; line-height:1.7; font-size:1.05rem; color:var(--color-text); margin:0; }

    /* Hanoi game */
    #hanoi-game-container{ display:flex; flex-direction:column; align-items:center; justify-content:center; padding:1rem; background:#f8f8f8; border-radius:10px;}
    .pegs-container{
      display:flex; justify-content:space-between; width:95%; max-width:760px; height:220px; align-items:flex-end; padding:0 12px; position:relative; border-bottom:18px solid var(--color-base-wood); box-shadow: 0 4px 10px rgba(0,0,0,.12);
    }
    .peg{ width:16px; height:100%; background:var(--color-peg-wood); border-radius:6px 6px 0 0; position:relative; display:flex; flex-direction:column-reverse; align-items:center; cursor:pointer; box-shadow:inset 0 0 5px rgba(0,0,0,0.35); }
    .peg .peg-label{ position:absolute; top:-26px; font-weight:700; color:var(--color-text); font-size:0.95rem; }
    .peg:focus{ outline:3px solid rgba(30,144,255,0.35); outline-offset:6px;}
    .peg.target-ready{ background-color:#6aa84f; }
    .disk{ position:absolute; height:24px; bottom:0; border-radius:6px; border:1px solid #1e2a40; box-shadow:0 3px 6px rgba(0,0,0,0.35); transform-origin:center bottom; transition:transform .25s ease, bottom .25s ease; cursor:pointer; }
    .disk.selected{ background:#e74c3c !important; transform:translateY(-28px); z-index:20; }
    .disk[data-size="1"]{ width:35%; background:linear-gradient(to top,#77d4f9,#a8e5ff); }
    .disk[data-size="2"]{ width:55%; background:linear-gradient(to top,#00bfff,#5bd8ff); }
    .disk[data-size="3"]{ width:75%; background:linear-gradient(to top,#1e90ff,#5aaaff); }
    .disk[data-size="4"]{ width:95%; background:linear-gradient(to top,#005A9C,#0088e0); }
    .controls{ text-align:center; margin-top:1rem; display:flex; gap:10px; flex-wrap:wrap; justify-content:center; align-items:center; }
    button{ padding:10px 16px; border-radius:8px; border:none; cursor:pointer; font-weight:700; }
    #resetHanoiBtn{ background:var(--color-primary); color:white; box-shadow:0 6px 12px rgba(0,0,0,0.12);}
    #undoHanoiBtn{ background:#f0f0f0; color:var(--color-text); }
    #autoSolveBtn{ background:var(--color-gold); color:var(--color-text); }
    #hanoiMessage{ font-weight:600; color:var(--color-text); margin:0.25rem; }
    #hanoiMoves{ font-weight:700; color:var(--color-text); }

    /* Daily quote */
    .daily-quote-section{ background:var(--color-motivation); border:3px solid #6aa84f; padding:2.5rem; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,0.12); text-align:center;}
    .motivation-controls{ display:flex; gap:12px; justify-content:center; margin-top:1rem; flex-wrap:wrap; }
    .modal{ display:none; position:fixed; z-index:10000; left:0; top:0; width:100%; height:100%; background-color: rgba(0,0,0,0.85); backdrop-filter: blur(4px); justify-content:center; align-items:center; padding:20px;}
    .modal[aria-hidden="false"]{ display:flex; }
    .modal-content{ max-width:90%; max-height:90%; border-radius:12px; box-shadow: 0 0 30px rgba(255,255,255,0.15); background:#fff; overflow:auto; padding:10px; }
    .modal img, .modal video{ max-width:100%; max-height:80vh; display:block; margin:auto; }
    .close{ position:absolute; top:18px; right:28px; color:#fff; font-size:36px; font-weight:700; cursor:pointer; }
    .quotes-modal-content{ background:white; padding:22px; border-radius:12px; max-width:760px; width:100%; }
    .quotes-list{ max-height:60vh; overflow:auto; padding:0 6px; margin:0; }
    .quotes-list li{ list-style:none; padding:10px 6px; border-bottom:1px dashed #eee; }
    .solution-table{ width:100%; border-collapse:collapse; margin-top:12px;}
    .solution-table th, .solution-table td{ padding:8px; border:1px solid #ddd; text-align:center; }
    .sr-only{ position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
    @media (max-width:480px){ header{ padding:2rem 0.5rem } .pegs-container{ height:180px } }
  </style>
</head>
<body>
  <header>
    <h1>üéâ Happy Birthday Ruchita üíôüçö</h1>
    <p>Wishing you endless joy, laughter, and rice bowls forever üåæüçö‚ú®</p>
    <!-- Canvas-based confetti (lightweight) -->
    <canvas class="confetti-canvas" id="confettiCanvas" aria-hidden="true"></canvas>
  </header>

  <main>
    <!-- Memory wall -->
    <section id="memory-wall-section" aria-labelledby="mem-wall-heading">
      <h2 id="mem-wall-heading">üì∏ ‡§Æ‡•á‡§Æ‡§∞‡•Ä ‡§µ‡•â‡§≤ (Memory Wall)</h2>
      <p style="text-align:center;font-style:italic;color:#555;">(Tap, click, or press Enter on any media to view full screen ‚Äî 8 photo spots)</p>
      <div id="preview" aria-live="polite" aria-label="Photo gallery"></div>
    </section>

    <!-- Videos -->
    <section id="video-memories-section" aria-labelledby="video-heading">
      <h2 id="video-heading">üéûÔ∏è Video Memories</h2>
      <p style="text-align:center;color:var(--color-text);margin-bottom:14px;">Click a placeholder to load each video (saves bandwidth). Remember: set Drive files to 'Anyone with link can view'.</p>
      <div id="videoEmbedsContainer" aria-live="polite"></div>
    </section>

    <!-- Thank you note -->
    <section id="thank-you-section" aria-labelledby="thank-heading">
      <h2 id="thank-heading">üíå ‡§ú‡§æ‡§∏‡•ç‡§§ ‡§ö‡•Å‡§∞‡•Å ‡§ö‡•Å‡§∞‡•Å ‡§®‡§æ‡§π‡•Ä ‡§¨‡•ã‡§≤‡§æ‡§Ø‡§ö‡§Ç</h2>
      <div class="thank-you-note" role="note">
        <h3 style="color:var(--color-primary);font-family:'Poppins',sans-serif;margin-bottom:8px;">‡§Ü‡§µ‡§°‡§§‡•ç‡§Ø‡§æ ‡§∏‡§Ç‡§ú‡•ç‡§û‡§æ (Favourite Terms)</h3>
        <ul class="favourite-terms-list">
          <li>‚Äî <strong>‡§Æ‡§Ç‡§¶‡§¨‡§¶‡§ï</strong> (Mandbadak)</li>
          <li>‚Äî <strong>‡§™‡§æ‡§ó‡§≤ ‡§™‡•ã‡§∞‡§ó‡§æ</strong> (Pagal Porga)</li>
          <li>‚Äî <strong>‡§µ‡§ü‡§µ‡§æ‡§ò‡•Ç‡§≥</strong> (Vatvaaghool)</li>
          <li>‚Äî <strong>‡§ò‡•Å‡§¨‡§°</strong> (Ghubad)</li>
          <li>‚Äî <strong>‡§§‡•Å‡§∑‡§æ‡§∞ ‡§∏‡§∞rrrrrrrr</strong> (Tushar Sirrrrrrrrr)</li>
        </ul>
        <span class="sender" style="display:block;margin-top:12px;font-weight:600;font-style:italic;">‚Äî ‡§∏‡§¶‡•à‡§µ ‡§Ü‡§¶‡§∞‡•ç‡§∂</span>
      </div>
    </section>

    <!-- Hanoi game -->
    <section id="hanoi-section" aria-labelledby="hanoi-heading">
      <h2 id="hanoi-heading">üß† ‡§ü‡•â‡§µ‡§∞ ‡§ë‡§´ ‡§π‡§®‡•ã‡§à (Tower of Hanoi)</h2>
      <p style="text-align:center;font-style:italic;color:#555;margin-bottom:8px;">(Move 4 disks from Peg A to Peg D in the fewest moves ‚Äî keyboard & touch supported)</p>
      <div id="hanoi-game-container" aria-live="polite" aria-atomic="true">
        <div class="pegs-container" id="pegsContainer" role="application" aria-label="Tower of Hanoi board">
          <div id="peg-A" class="peg" data-peg="A" tabindex="0" role="button" aria-label="Peg A"><span class="peg-label">A</span></div>
          <div id="peg-B" class="peg" data-peg="B" tabindex="0" role="button" aria-label="Peg B"><span class="peg-label">B</span></div>
          <div id="peg-C" class="peg" data-peg="C" tabindex="0" role="button" aria-label="Peg C"><span class="peg-label">C</span></div>
          <div id="peg-D" class="peg" data-peg="D" tabindex="0" role="button" aria-label="Peg D"><span class="peg-label">D</span></div>
        </div>

        <div class="controls" aria-hidden="false">
          <p id="hanoiMessage" aria-live="polite">Tap or press Enter/Space on a peg to pick or place a disk.</p>
          <p id="hanoiMoves" aria-live="polite">Moves: 0</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;">
            <button id="resetHanoiBtn" aria-label="Reset game">Reset</button>
            <button id="undoHanoiBtn" aria-label="Undo last move">Undo</button>
            <button id="autoSolveBtn" aria-label="Auto-solve animation">Auto Solve</button>
            <button id="showSolutionBtn" aria-label="Show solution steps">Solution (Steps)</button>
            <span id="bestScore" style="font-weight:700;align-self:center;margin-left:8px;"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- Daily quotes -->
    <section class="daily-quote-section" aria-labelledby="quote-heading">
      <h2 id="quote-heading">üí° Daily Dose of Inspiration</h2>
      <div id="dailyQuoteDisplay" style="text-align:center;">
        <p id="motivationalQuote" style="font-size:clamp(1.1rem,4vw,1.4rem);font-weight:600;color:#38761d;margin-bottom:6px;"></p>
        <span id="quoteAuthor" style="display:block;font-style:italic;color:#6aa84f;"></span>
      </div>
      <div class="motivation-controls" style="justify-content:center;margin-top:12px;">
        <button id="shuffleQuoteBtn" aria-label="Shuffle quote" style="background:#6aa84f;color:white">‚ú® Shuffle Quote</button>
        <button id="viewAllQuotesBtn" aria-label="View all quotes" style="background:#5b8f3b;color:white">View All 12 Quotes</button>
      </div>
    </section>
  </main>

  <!-- Modals -->
  <div id="mediaModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <button class="close" aria-label="Close media">&times;</button>
    <img id="modalImage" class="modal-content" alt="Full size media" style="display:none">
    <video id="modalVideo" class="modal-content" controls style="display:none"></video>
  </div>

  <div id="allQuotesModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="quotes-modal-content" role="document" aria-labelledby="all-quotes-title" onclick="event.stopPropagation()">
      <button class="close" aria-label="Close quotes" style="position:absolute;right:18px;top:18px">&times;</button>
      <h3 id="all-quotes-title" style="text-align:center;color:var(--color-primary);margin-top:0;">‚ú® All 12 Inspirational Quotes ‚ú®</h3>
      <ul id="quotesList" class="quotes-list" style="padding:0;margin:0;"></ul>
    </div>
  </div>

  <div id="hanoiSolutionModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="quotes-modal-content" role="document" onclick="event.stopPropagation()">
      <button class="close" aria-label="Close solution" style="position:absolute;right:18px;top:18px">&times;</button>
      <h3 style="text-align:center;color:var(--color-primary);margin-top:0;">Optimal Solution (9 Moves)</h3>
      <p style="text-align:center;">Fastest way to move 4 disks from Peg A to Peg D:</p>
      <table class="solution-table" aria-hidden="false">
        <thead><tr><th>Step</th><th>Disk</th><th>From</th><th>To</th></tr></thead>
        <tbody id="solutionBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Screen-reader-only live region for announcements -->
  <div class="sr-only" id="srAnnouncements" aria-live="polite" aria-atomic="true"></div>

  <script>
    /* ==========================
       1. Confetti (canvas-based, respects reduced motion)
       ========================== */
    (function(){
      const canvas = document.getElementById('confettiCanvas');
      const ctx = canvas.getContext('2d');
      let W = 0, H = 0;
      const particles = [];
      function resize(){ W = canvas.width = canvas.offsetWidth; H = canvas.height = canvas.offsetHeight; }
      window.addEventListener('resize', resize);
      resize();

      const reduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (reduced) { canvas.style.display='none'; return; }

      function spawn(){
        const x = Math.random()*W;
        particles.push({x, y:-10, vx:(Math.random()-0.5)*1.8, vy:2+Math.random()*2.6, r:3+Math.random()*5, rot:Math.random()*Math.PI*2, vr: (Math.random()-0.5)*0.08});
      }
      function step(){
        ctx.clearRect(0,0,W,H);
        if (Math.random() < 0.35) spawn();
        for (let i=particles.length-1;i>=0;i--){
          const p = particles[i];
          p.x += p.vx; p.y += p.vy; p.vy += 0.02; p.rot += p.vr;
          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rot);
          ctx.beginPath();
          ctx.ellipse(0,0,p.r,p.r*1.5,0,0,Math.PI*2);
          ctx.fillStyle = 'rgba(180,220,255,0.95)';
          ctx.fill();
          ctx.restore();
          if (p.y > H + 30) particles.splice(i,1);
        }
        requestAnimationFrame(step);
      }
      step();
    })();

    /* ==========================
       2. Memory wall (images) - with alt & lazy loading
       ========================== */
    const mediaUrls = [
      {url:"./assets/RUCHITA_IMAGE_1.jpg", type:"image", alt:"Ruchita smiling at the beach"},
      {url:"./assets/RUCHITA_IMAGE_2.jpg", type:"image", alt:"Ruchita with friends"},
      {url:"./assets/RUCHITA_IMAGE_3.jpg", type:"image", alt:"Ruchita candid moment"},
      {url:"./assets/RUCHITA_IMAGE_4.jpg", type:"image", alt:"Ruchita during celebration"},
      {url:"./assets/RUCHITA_IMAGE_5.jpg", type:"image", alt:"Ruchita laughing"},
      {url:"./assets/RUCHITA_IMAGE_6.jpg", type:"image", alt:"Ruchita portrait"},
      {url:"./assets/RUCHITA_IMAGE_7.jpg", type:"image", alt:"Ruchita and cake"},
      {url:"./assets/RUCHITA_IMAGE_8.jpg", type:"image", alt:"Ruchita with friends at event"}
    ];

    const previewContainer = document.getElementById('preview');
    const mediaModal = document.getElementById('mediaModal');
    const modalImage = document.getElementById('modalImage');
    const modalVideo = document.getElementById('modalVideo');
    const srAnnouncements = document.getElementById('srAnnouncements');

    function setupMemoryWall(){
      mediaUrls.forEach((media, idx) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'media-item';
        wrapper.setAttribute('role','button');
        wrapper.setAttribute('tabindex','0');
        wrapper.setAttribute('aria-label', media.alt || 'Birthday memory photo');
        if (media.type === 'image') {
          const img = document.createElement('img');
          img.src = media.url;
          img.alt = media.alt || 'Birthday photo';
          img.loading = 'lazy';
          wrapper.appendChild(img);
        } else {
          const vid = document.createElement('video');
          vid.src = media.url; vid.muted=true; vid.loop=true; vid.playsInline=true;
          vid.setAttribute('aria-hidden','true');
          wrapper.appendChild(vid);
        }
        wrapper.addEventListener('click', ()=> openMediaModal(media.url, media.type));
        wrapper.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openMediaModal(media.url, media.type); } });
        previewContainer.appendChild(wrapper);
      });
    }

    /* Accessible modal open/close with focus handling and Esc */
    function openMediaModal(url, type) {
      // set visible
      mediaModal.setAttribute('aria-hidden','false');
      // save focus
      mediaModal._previousFocus = document.activeElement;
      // show the right element
      if (type === 'image') {
        modalVideo.style.display='none';
        modalVideo.pause(); modalVideo.src='';
        modalImage.src = url;
        modalImage.style.display='block';
        modalImage.focus();
      } else {
        modalImage.style.display='none';
        modalImage.src='';
        modalVideo.src = url;
        modalVideo.style.display='block';
        modalVideo.controls = true;
        modalVideo.play().catch(()=>{ /* ignored */});
        modalVideo.focus();
      }
      document.addEventListener('keydown', mediaModalKeyHandler);
    }
    function closeMediaModal(){
      mediaModal.setAttribute('aria-hidden','true');
      // stop video
      modalVideo.pause(); modalVideo.src = '';
      // restore focus
      if (mediaModal._previousFocus) mediaModal._previousFocus.focus();
      document.removeEventListener('keydown', mediaModalKeyHandler);
    }
    function mediaModalKeyHandler(e){
      if (e.key === 'Escape') closeAllOpenModals();
      // focus trap (simple)
      if (e.key === 'Tab'){
        const focusables = Array.from(mediaModal.querySelectorAll('button, [href], input, textarea, [tabindex]:not([tabindex="-1"])')).filter(n=>n.offsetParent!==null);
        if (focusables.length === 0) return;
        const first = focusables[0], last = focusables[focusables.length-1];
        if (e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
        else if (!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
      }
    }

    // close when clicking close or outside
    Array.from(document.querySelectorAll('.modal .close')).forEach(btn=>{
      btn.addEventListener('click', (ev)=>{
        // find parent modal
        const modal = btn.closest('.modal');
        if (modal === mediaModal) closeMediaModal();
        else if (modal.id === 'allQuotesModal') closeAllQuotesModal();
        else if (modal.id === 'hanoiSolutionModal') closeHanoiSolutionModal();
      });
    });
    // clicking overlay closes
    document.querySelectorAll('.modal').forEach(m=>{
      m.addEventListener('click', ()=> {
        if (m === mediaModal) closeMediaModal();
        else if (m === allQuotesModal) closeAllQuotesModal();
        else if (m === hanoiSolutionModal) closeHanoiSolutionModal();
      });
    });

    /* ==========================
       3. Drive videos: lazy load with IntersectionObserver
       ========================== */
    const driveVideoIds = [
      "1G7VcF6Tpow7YDj6aWl5QwYXX7XAmG-QC",
      "1WbtDdChJbIwLrvc_4YpXz3IUyTool0kt",
      "1gRbI7djlHEPO4cdKj5_D6JTBdqVEgfLq"
    ];
    const videoEmbedsContainer = document.getElementById('videoEmbedsContainer');

    function setupDriveVideos(){
      if (!driveVideoIds || driveVideoIds.length === 0) {
        videoEmbedsContainer.innerHTML = `<p style="color:var(--color-text);text-align:center;font-style:italic;">No Drive IDs set. Add them in the script to load videos.</p>`;
        return;
      }
      driveVideoIds.forEach(id => {
        const wrapper = document.createElement('div');
        wrapper.className = 'video-wrapper';
        wrapper.setAttribute('tabindex','0');
        wrapper.setAttribute('role','button');
        wrapper.setAttribute('aria-label','Load video from Drive');
        const placeholder = document.createElement('div');
        placeholder.className = 'video-placeholder';
        placeholder.textContent = 'Load Video';
        placeholder.dataset.driveId = id;
        wrapper.appendChild(placeholder);
        videoEmbedsContainer.appendChild(wrapper);
        // clicking placeholder loads the iframe
        placeholder.addEventListener('click', ()=> loadDriveIframe(wrapper, id));
        placeholder.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') loadDriveIframe(wrapper, id); });
      });

      // Lazy-load as they come into view (intersection)
      const observer = new IntersectionObserver((entries, obs)=>{
        entries.forEach(entry=>{
          if (!entry.isIntersecting) return;
          const ph = entry.target.querySelector('.video-placeholder');
          if (ph){
            const id = ph.dataset.driveId;
            loadDriveIframe(entry.target, id);
            obs.unobserve(entry.target);
          }
        });
      }, {rootMargin:'200px'});
      document.querySelectorAll('.video-wrapper').forEach(w=> observer.observe(w));
    }

    function loadDriveIframe(container, id){
      // guard if already loaded
      if (container.dataset.loaded === 'true') return;
      const iframe = document.createElement('iframe');
      iframe.src = `https://drive.google.com/file/d/${id}/preview`;
      iframe.width='100%'; iframe.height='100%'; iframe.style.border='none';
      iframe.setAttribute('allow','autoplay; fullscreen');
      iframe.setAttribute('title','Shared Video Memory');
      container.innerHTML = '';
      container.appendChild(iframe);
      container.dataset.loaded = 'true';
    }

    /* ==========================
       4. Tower of Hanoi (4 pegs, 4 disks) with keyboard support, undo, autosolve
       ========================== */
    const hanoi = {
      pegs: { A: [4,3,2,1], B:[], C:[], D:[] },
      moves:0, selectedDisk:null, sourcePeg:null, diskElements:{}, moveHistory:[], solved:false
    };
    const optimalMoves = [
      {disk:1, from:'A', to:'C'},
      {disk:2, from:'A', to:'B'},
      {disk:1, from:'C', to:'B'},
      {disk:3, from:'A', to:'D'},
      {disk:4, from:'A', to:'C'},
      {disk:3, from:'D', to:'C'},
      {disk:1, from:'B', to:'A'},
      {disk:2, from:'B', to:'D'},
      {disk:1, from:'A', to:'D'}
    ];
    const pegElements = {
      A: document.getElementById('peg-A'),
      B: document.getElementById('peg-B'),
      C: document.getElementById('peg-C'),
      D: document.getElementById('peg-D')
    };
    const hanoiMessage = document.getElementById('hanoiMessage');
    const hanoiMoves = document.getElementById('hanoiMoves');
    const pegsContainer = document.getElementById('pegsContainer');
    const numDisks = 4;
    const targetPegId = 'D';
    const bestScoreEl = document.getElementById('bestScore');

    function createDiskElements(){
      for (let i=1;i<=numDisks;i++){
        const d = document.createElement('div');
        d.className='disk';
        d.dataset.size = i;
        d.id = 'disk-'+i;
        d.setAttribute('aria-hidden','true');
        // click for accessibility we will use peg clicks; disks are visual only
        hanoi.diskElements[i] = d;
      }
    }

    function updateHanoiUI(){
      // remove old disks
      document.querySelectorAll('.disk').forEach(x=>x.remove());
      // attach new disks
      Object.keys(hanoi.pegs).forEach(pegId=>{
        const peg = pegElements[pegId];
        hanoi.pegs[pegId].forEach((diskSize, index)=>{
          const el = hanoi.diskElements[diskSize];
          // compute left offset center
          el.style.bottom = `${index * 24}px`;
          // set width as percent of peg's container width
          // append to peg for stacking
          peg.appendChild(el);
          el.style.left = `${(peg.clientWidth - el.offsetWidth)/2}px`;
        });
      });
      hanoiMoves.textContent = `Moves: ${hanoi.moves}`;
      // win check
      if (hanoi.pegs[targetPegId].length === numDisks && !hanoi.solved){
        hanoi.solved = true;
        announce(`You win! Solved in ${hanoi.moves} moves.`);
        document.getElementById('hanoi-section').classList.add('hanoi-win');
        // save best
        saveBestScore();
        // disable clicks
      }
      updateBestScoreUI();
    }

    function isValidMove(diskSize, toPegId){
      const target = hanoi.pegs[toPegId];
      const top = target[target.length-1];
      return target.length === 0 || diskSize < top;
    }

    function hanoiClickHandler(event){
      if (hanoi.solved) return;
      const targetPegElement = event.target.closest('.peg');
      if (!targetPegElement) return;
      const clickedPegId = targetPegElement.dataset.peg;
      const source = hanoi.pegs[clickedPegId];
      const top = source[source.length-1];

      // clear previous highlights
      Object.values(pegElements).forEach(p=>p.classList.remove('target-ready'));

      if (!hanoi.selectedDisk){
        if (source.length>0){
          hanoi.selectedDisk = top;
          hanoi.sourcePeg = clickedPegId;
          // highlight valid targets
          Object.keys(hanoi.pegs).forEach(pid=>{
            if (pid !== hanoi.sourcePeg && isValidMove(hanoi.selectedDisk, pid)) pegElements[pid].classList.add('target-ready');
          });
          hanoi.diskElements[top].classList.add('selected');
          hanoiMessage.textContent = `Selected disk ${hanoi.selectedDisk}. Choose target peg.`;
          hanoiMessage.style.color = 'var(--color-primary)';
          announce(`Selected disk ${hanoi.selectedDisk} from peg ${hanoi.sourcePeg}`);
        } else {
          hanoiMessage.textContent = 'That peg is empty. Choose another.';
          hanoiMessage.style.color = '#e74c3c';
        }
      } else {
        // placing
        const diskToMove = hanoi.selectedDisk;
        if (clickedPegId === hanoi.sourcePeg){
          // deselect
          hanoi.diskElements[diskToMove].classList.remove('selected');
          hanoi.selectedDisk = null; hanoi.sourcePeg = null;
          hanoiMessage.textContent = 'Deselected disk.';
          hanoiMessage.style.color = 'var(--color-text)';
          announce('Deselected disk');
          return;
        }
        if (isValidMove(diskToMove, clickedPegId)){
          // perform move
          hanoi.pegs[hanoi.sourcePeg].pop();
          hanoi.pegs[clickedPegId].push(diskToMove);
          hanoi.moveHistory.push({disk:diskToMove, from:hanoi.sourcePeg, to:clickedPegId});
          hanoi.diskElements[diskToMove].classList.remove('selected');
          hanoi.moves++;
          hanoi.selectedDisk = null; hanoi.sourcePeg = null;
          hanoiMessage.textContent = `Moved disk ${diskToMove} to peg ${clickedPegId}.`;
          hanoiMessage.style.color = '#38761d';
          announce(`Moved disk ${diskToMove} to peg ${clickedPegId}. Moves ${hanoi.moves}`);
          updateHanoiUI();
        } else {
          hanoiMessage.textContent = 'Invalid move. Disk must be smaller than the one below it.';
          hanoiMessage.style.color = '#e74c3c';
        }
      }
    }

    // keyboard support for pegs
    function attachPegKeyboard(){
      Object.keys(pegElements).forEach(pid=>{
        const el = pegElements[pid];
        el.addEventListener('keydown', e=>{
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); hanoiClickHandler({ target: el }); }
        });
      });
    }

    function resetHanoi(){
      hanoi.pegs = { A:[4,3,2,1], B:[], C:[], D:[] };
      hanoi.moves = 0; hanoi.selectedDisk = null; hanoi.sourcePeg = null; hanoi.moveHistory = []; hanoi.solved=false;
      hanoiMessage.textContent = 'Tap or press Enter/Space on a peg to pick or place a disk.';
      hanoiMessage.style.color = 'var(--color-text)';
      updateHanoiUI();
    }

    // Undo: revert last move
    function undoMove(){
      if (hanoi.moveHistory.length === 0) {
        announce('No moves to undo.');
        return;
      }
      const last = hanoi.moveHistory.pop();
      const toPeg = hanoi.pegs[last.to];
      // remove disk from 'to' peg top (should match)
      if (toPeg[toPeg.length-1] === last.disk) {
        toPeg.pop();
        hanoi.pegs[last.from].push(last.disk);
        hanoi.moves = Math.max(0, hanoi.moves - 1);
        hanoiMessage.textContent = `Undid move of disk ${last.disk}.`;
        announce(`Undid move of disk ${last.disk}.`);
        updateHanoiUI();
      } else {
        // corruption - fallback: rebuild (rare)
        hanoiMessage.textContent = 'Unable to undo due to state mismatch. Resetting.';
        resetHanoi();
      }
    }

    // Auto-play optimalMoves visually
    let autoSolving = false;
    async function autoSolve(){
      if (autoSolving) return;
      autoSolving = true;
      // disable manual input (we'll still let undo toggle maybe)
      hanoiMessage.textContent = 'Auto-solving...';
      hanoiMessage.style.color = 'var(--color-primary)';
      // reset first to start clean
      resetHanoi();
      for (let m of optimalMoves){
        await new Promise(r=>setTimeout(r, 600));
        // perform
        hanoi.pegs[m.from].pop();
        hanoi.pegs[m.to].push(m.disk);
        hanoi.moves++;
        hanoi.moveHistory.push({disk:m.disk,from:m.from,to:m.to});
        updateHanoiUI();
      }
      autoSolving = false;
    }

    // show solution modal table
    function openHanoiSolutionModal(){
      const solutionModal = document.getElementById('hanoiSolutionModal');
      const body = document.getElementById('solutionBody');
      body.innerHTML = '';
      optimalMoves.forEach((m,i)=>{
        const row = document.createElement('tr');
        row.innerHTML = `<td>${i+1}</td><td>${m.disk}</td><td>${m.from}</td><td>${m.to}</td>`;
        body.appendChild(row);
      });
      openModalById('hanoiSolutionModal');
    }
    function closeHanoiSolutionModal(){ closeModalById('hanoiSolutionModal'); }

    // best score localStorage
    function saveBestScore(){
      const best = Number(localStorage.getItem('hanoiBest') || '9999');
      if (hanoi.moves < best){
        localStorage.setItem('hanoiBest', hanoi.moves);
        announce(`New best! ${hanoi.moves} moves.`);
      }
      updateBestScoreUI();
    }
    function updateBestScoreUI(){
      const best = localStorage.getItem('hanoiBest');
      bestScoreEl.textContent = best ? `Best: ${best}` : 'Best: ‚Äî';
    }

    /* ==========================
       5. Quotes (shuffle, view all)
       ========================== */
    const dailyQuotes = [
      { quote:"‚ú® To gain something in life, you have to lose something. ‚ú®", author:"Unknown" },
      { quote:"‚ú® Set your goal, work hard, and success will be yours. ‚ú®", author:"Swami Vivekananda" },
      { quote:"‚ú® The greatest glory in living lies not in never falling, but in rising every time you fall. ‚ú®", author:"Nelson Mandela" },
      { quote:"‚ú® Believe in yourself, because you are very special. ‚ú®", author:"Inspirational Saying" },
      { quote:"‚ú® Life is beautiful, just learn how to live it. ‚ú®", author:"Gulzar" },
      { quote:"‚ú® Every day is a new beginning, never give up. ‚ú®", author:"Great Personality" },
      { quote:"‚ú® When you change, the world changes. ‚ú®", author:"Mahatma Gandhi" },
      { quote:"‚ú® Challenges come because we can learn something from them. ‚ú®", author:"Siddhartha" },
      { quote:"‚ú® Where there is effort, there is certainly success. ‚ú®", author:"Source of Inspiration" },
      { quote:"‚ú® Make today better than yesterday. ‚ú®", author:"Motivational Message" },
      { quote:"‚ú® To live a happy life, keep control over your thoughts. ‚ú®", author:"Epictetus" },
      { quote:"‚ú® You may be leaving the place, but the impact you‚Äôve made will stay. ‚ú®", author:"Adarsh" }
    ];
    const quotesList = document.getElementById('quotesList');
    const allQuotesModal = document.getElementById('allQuotesModal');

    function displayRandomQuote(){
      const i = Math.floor(Math.random()*dailyQuotes.length);
      const q = dailyQuotes[i];
      document.getElementById('motivationalQuote').textContent = q.quote;
      document.getElementById('quoteAuthor').textContent = `‚Äî ${q.author}`;
    }
    function viewAllQuotes(){
      quotesList.innerHTML = '';
      dailyQuotes.forEach(q=>{
        const li = document.createElement('li');
        li.innerHTML = `${q.quote} <span style="display:block;font-style:italic;color:#6aa84f;margin-top:6px;">‚Äî ${q.author}</span>`;
        quotesList.appendChild(li);
      });
      openModalById('allQuotesModal');
    }
    function closeAllQuotesModal(){ closeModalById('allQuotesModal'); }

    /* ==========================
       6. Modal utilities (generic open/close)
       ========================== */
    function openModalById(id){
      const modal = document.getElementById(id);
      if (!modal) return;
      modal.setAttribute('aria-hidden','false');
      modal._previousFocus = document.activeElement;
      // focus first focusable
      const focusable = modal.querySelector('button, [href], input, textarea, [tabindex]:not([tabindex="-1"])');
      if (focusable) focusable.focus();
      document.addEventListener('keydown', globalModalKeyHandler);
    }
    function closeModalById(id){
      const modal = document.getElementById(id);
      if (!modal) return;
      modal.setAttribute('aria-hidden','true');
      if (modal._previousFocus) modal._previousFocus.focus();
      document.removeEventListener('keydown', globalModalKeyHandler);
    }
    function closeAllOpenModals(){
      document.querySelectorAll('.modal[aria-hidden="false"]').forEach(m => {
        m.setAttribute('aria-hidden','true');
        if (m._previousFocus) m._previousFocus.focus();
      });
      document.removeEventListener('keydown', globalModalKeyHandler);
    }
    function globalModalKeyHandler(e){
      if (e.key === 'Escape') closeAllOpenModals();
    }

    /* ==========================
       7. Utilities: announcer for screen readers
       ========================== */
    function announce(text){
      srAnnouncements.textContent = '';
      setTimeout(()=> { srAnnouncements.textContent = text; }, 20);
    }

    /* ==========================
       8. Wire up events & init
       ========================== */
    document.addEventListener('DOMContentLoaded', ()=>{
      setupMemoryWall();
      setupDriveVideos();

      // initialize hanoi
      createDiskElements();
      updateHanoiUI();
      attachPegKeyboard();

      // attach main click handler for pegs
      pegsContainer.addEventListener('click', hanoiClickHandler);

      // buttons
      document.getElementById('resetHanoiBtn').addEventListener('click', ()=> { resetHanoi(); announce('Game reset.'); });
      document.getElementById('undoHanoiBtn').addEventListener('click', undoMove);
      document.getElementById('autoSolveBtn').addEventListener('click', autoSolve);
      document.getElementById('showSolutionBtn').addEventListener('click', openHanoiSolutionModal);

      // quotes
      document.getElementById('shuffleQuoteBtn').addEventListener('click', displayRandomQuote);
      document.getElementById('viewAllQuotesBtn').addEventListener('click', viewAllQuotes);

      // modal close behavior for allQuotes & Hanoi solution: close when clicking close btn or background handled earlier
      // close modal close via close buttons already wired to generic handler above

      // initial quote
      displayRandomQuote();
      updateBestScoreUI();
      // set add close handlers for media modal close button
      document.querySelector('#mediaModal .close').addEventListener('click', closeMediaModal);
    });

    /* ==========================
       9. Small polyfills & safety
       ========================== */
    // Prevent pointer selection when dragging on mobile for pegs
    Object.values(pegElements).forEach(p => {
      p.addEventListener('touchstart', e=> e.preventDefault());
    });
  </script>
</body>
</html>

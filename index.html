<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Happy Birthday Ruchitaaa üéâüíô</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Happy Birthday Ruchita ‚Äî photos, videos, a mini Tower of Hanoi game and daily quotes." />
  <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --color-primary:#1e90ff; --color-secondary:#4da6ff; --color-background:#e0f2ff; --color-text:#1e2a40;
      --color-gold:#FFD700; --accent:#6aa84f;
    }
    html,body{height:100%}
    body{margin:0;font-family:'Poppins',sans-serif;color:var(--color-text);background:linear-gradient(135deg,var(--color-background),#c2e0ff);-webkit-font-smoothing:antialiased;}
    header{text-align:center;padding:3.5rem 1rem;background:linear-gradient(135deg,var(--color-secondary),var(--color-primary));color:#fff;position:relative;overflow:hidden;border-bottom-left-radius:30px;border-bottom-right-radius:30px;box-shadow:0 6px 15px rgba(0,0,0,0.25);}
    header h1{ font-family:'Gochi Hand',cursive; font-size:clamp(2.5rem,8vw,4rem); margin:0; text-shadow:0 4px 8px rgba(0,0,0,0.35);}
    header p{ font-size:clamp(1rem,3vw,1.2rem); margin-top:.5rem; opacity:.95;}
    .confetti-canvas { position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; }
    main{max-width:1100px;margin:2rem auto;padding:0 1rem;}
    section{ background:#fff;padding:2.2rem;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,0.12);margin-bottom:1.4rem;}
    section h2{ text-align:center;color:var(--color-primary);margin-bottom:1rem;font-weight:700;font-size:1.6rem}
    #preview{ display:grid; grid-template-columns: repeat(auto-fill,minmax(160px,1fr)); gap:14px; justify-items:center; margin-top:1rem; }
    .media-item{ width:100%; max-width:220px; height:140px; overflow:hidden; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.18); cursor:pointer; border:2px solid var(--color-secondary); display:flex; align-items:center; justify-content:center; background:#fafafa; position:relative; }
    .like-btn{ position:absolute; right:8px; top:8px; background:rgba(255,255,255,0.9); border-radius:999px; padding:6px; border:none; display:inline-flex; align-items:center; justify-content:center; cursor:pointer; font-size:14px; }
    .like-btn.liked{ color:#e0245e; transform:scale(1.08); }
    .media-item img, .media-item video{ width:100%; height:100%; object-fit:cover; display:block; }
    .media-item:focus{ outline:3px solid rgba(30,144,255,0.35); outline-offset:3px; }
    #videoEmbedsContainer{ display:flex; flex-direction:column; gap:18px; align-items:center; margin-top:10px;}
    .video-wrapper{ width:100%; max-width:640px; border-radius:12px; overflow:hidden; box-shadow:0 8px 16px rgba(0,0,0,0.18); aspect-ratio:16/9; background:#111; display:flex; align-items:center; justify-content:center; }
    .thank-you-note{ background: #fff8e1; border:3px solid #FFD700; padding:1.5rem; border-radius:12px; text-align:center; box-shadow:0 6px 15px rgba(255,215,0,0.12); }
    .pegs-container{ display:flex; justify-content:space-between; width:95%; max-width:760px; height:220px; align-items:flex-end; padding:0 12px; position:relative; border-bottom:18px solid #A0522D; box-shadow:0 4px 10px rgba(0,0,0,0.12); margin:0 auto; }
    .peg{ width:16px; height:100%; background:#8B4513; border-radius:6px 6px 0 0; position:relative; display:flex; flex-direction:column-reverse; align-items:center; cursor:pointer; box-shadow:inset 0 0 5px rgba(0,0,0,0.35); }
    .peg .peg-label{ position:absolute; top:-26px; font-weight:700; color:var(--color-text); font-size:0.95rem; }
    .disk{ position:absolute; height:24px; bottom:0; border-radius:6px; border:1px solid #1e2a40; box-shadow:0 3px 6px rgba(0,0,0,0.35); transform-origin:center bottom; transition:transform .25s ease, bottom .25s ease; touch-action:none; }
    .disk[data-size="1"]{ width:35%; background:linear-gradient(to top,#77d4f9,#a8e5ff); }
    .disk[data-size="2"]{ width:55%; background:linear-gradient(to top,#00bfff,#5bd8ff); }
    .disk[data-size="3"]{ width:75%; background:linear-gradient(to top,#1e90ff,#5aaaff); }
    .disk[data-size="4"]{ width:95%; background:linear-gradient(to top,#005A9C,#0088e0); }
    .disk.dragging{ opacity:0.95; transform:scale(1.03) rotate(4deg); z-index:9999; }
    .peg.target-ready{ background-color:#6aa84f; }
    .controls{ text-align:center; margin-top:1rem; display:flex; gap:10px; flex-wrap:wrap; justify-content:center; align-items:center; }
    button{ padding:10px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:700; }
    #resetHanoiBtn{ background:var(--color-primary); color:white; }
    #autoSolveBtn{ background:var(--color-gold); color:var(--color-text); }
    .daily-quote-section{ background:#d9ead3; border:3px solid #6aa84f; padding:1.8rem; border-radius:12px; text-align:center; }
    .modal{ display:none; position:fixed; z-index:10000; left:0; top:0; width:100%; height:100%; background-color: rgba(0,0,0,0.85); backdrop-filter: blur(4px); justify-content:center; align-items:center; padding:18px;}
    .modal[aria-hidden="false"]{ display:flex; }
    .modal-content{ max-width:94%; max-height:92%; border-radius:12px; background:#fff; overflow:hidden; display:flex; align-items:center; justify-content:center; position:relative; }
    .modal img{ max-width:100%; max-height:80vh; display:block; }
    .modal .nav{ position:absolute; top:50%; transform:translateY(-50%); font-size:34px; color:#fff; background:rgba(0,0,0,0.25); border-radius:999px; width:54px; height:54px; display:flex; align-items:center; justify-content:center; cursor:pointer; }
    .modal .nav.left{ left:12px; } .modal .nav.right{ right:12px; }
    .modal .close{ position:absolute; top:14px; right:14px; font-size:28px; color:#fff; background:rgba(0,0,0,0.2); border-radius:999px; width:44px; height:44px; display:flex; align-items:center; justify-content:center; cursor:pointer; }
    .modal .caption{ position:absolute; bottom:12px; left:12px; right:12px; color:#fff; font-weight:600; text-shadow:0 2px 8px rgba(0,0,0,0.6); display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .sound-toggle{ position:fixed; right:12px; bottom:12px; background:rgba(255,255,255,0.95); padding:8px; border-radius:8px; box-shadow:0 6px 12px rgba(0,0,0,0.08); border:none; cursor:pointer; }
    @media (max-width:480px){ .pegs-container{ height:180px } header{ padding:2rem 0.5rem } }
  </style>
</head>
<body>
  <header>
    <h1>üéâ Happy Birthday Ruchita üíôüçö</h1>
    <p>Wishing you endless joy, laughter, and rice bowls forever üåæüçö‚ú®</p>
    <canvas class="confetti-canvas" id="confettiCanvas" aria-hidden="true"></canvas>
  </header>

  <main>
    <section id="memory-wall-section" aria-labelledby="mem-wall-heading">
      <h2 id="mem-wall-heading">üì∏ ‡§Æ‡•á‡§Æ‡§∞‡•Ä ‡§µ‡•â‡§≤ (Memory Wall)</h2>
      <p style="text-align:center;font-style:italic;color:#555;">(Tap or press Enter on any media to open gallery ‚Äî 8 photo spots)</p>
      <div id="preview" aria-live="polite" aria-label="Photo gallery"></div>
    </section>

    <section id="video-memories-section" aria-labelledby="video-heading">
      <h2 id="video-heading">üéûÔ∏è Video Memories</h2>
      <p style="text-align:center;color:var(--color-text);margin-bottom:14px;">Click a placeholder to load each video (saves bandwidth). Set Drive files to 'Anyone with link can view'.</p>
      <div id="videoEmbedsContainer" aria-live="polite"></div>
    </section>

    <section id="thank-you-section" aria-labelledby="thank-heading">
      <h2 id="thank-heading">üíå ‡§ú‡§æ‡§∏‡•ç‡§§ ‡§ö‡•Å‡§∞‡•Å ‡§ö‡•Å‡§∞‡•Å ‡§®‡§æ‡§π‡•Ä ‡§¨‡•ã‡§≤‡§æ‡§Ø‡§ö‡§Ç</h2>
      <div class="thank-you-note" role="note">
        <h3 style="color:var(--color-primary);margin-bottom:6px;">‡§Ü‡§µ‡§°‡§§‡•ç‡§Ø‡§æ ‡§∏‡§Ç‡§ú‡•ç‡§û‡§æ (Favourite Terms)</h3>
        <ul style="text-align:left;padding:0 1rem;list-style:none;margin:0;">
          <li>‚Äî <strong>‡§Æ‡§Ç‡§¶‡§¨‡§¶‡§ï</strong></li>
          <li>‚Äî <strong>‡§™‡§æ‡§ó‡§≤ ‡§™‡•ã‡§∞‡§ó‡§æ</strong></li>
          <li>‚Äî <strong>‡§µ‡§ü‡§µ‡§æ‡§ò‡•Ç‡§≥</strong></li>
          <li>‚Äî <strong>‡§ò‡•Å‡§¨‡§°</strong></li>
          <li>‚Äî <strong>‡§§‡•Å‡§∑‡§æ‡§∞ ‡§∏‡§∞rrrrrrrr</strong></li>
        </ul>
        <span style="display:block;margin-top:10px;font-weight:600;font-style:italic;">‚Äî ‡§∏‡§¶‡•à‡§µ ‡§Ü‡§¶‡§∞‡•ç‡§∂</span>
      </div>
    </section>

    <section id="hanoi-section" aria-labelledby="hanoi-heading">
      <h2 id="hanoi-heading">üß† ‡§ü‡•â‡§µ‡§∞ ‡§ë‡§´ ‡§π‡§®‡•ã‡§à (Tower of Hanoi)</h2>
      <p style="text-align:center;font-style:italic;color:#555;margin-bottom:8px;">(Drag disks, or use keyboard: Enter/Space on pegs. Try to move 4 disks to Peg D)</p>
      <div id="hanoi-game-container" aria-live="polite">
        <div class="pegs-container" id="pegsContainer" role="application" aria-label="Tower of Hanoi board">
          <div id="peg-A" class="peg" data-peg="A" tabindex="0" role="button" aria-label="Peg A"><span class="peg-label">A</span></div>
          <div id="peg-B" class="peg" data-peg="B" tabindex="0" role="button" aria-label="Peg B"><span class="peg-label">B</span></div>
          <div id="peg-C" class="peg" data-peg="C" tabindex="0" role="button" aria-label="Peg C"><span class="peg-label">C</span></div>
          <div id="peg-D" class="peg" data-peg="D" tabindex="0" role="button" aria-label="Peg D"><span class="peg-label">D</span></div>
        </div>

        <div class="controls" aria-hidden="false">
          <p id="hanoiMessage" aria-live="polite">Tap or press Enter/Space on a peg to pick or place a disk.</p>
          <p id="hanoiMoves" aria-live="polite">Moves: 0</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;">
            <button id="resetHanoiBtn" aria-label="Reset game">Reset</button>
            <button id="undoHanoiBtn" aria-label="Undo last move">Undo</button>
            <button id="autoSolveBtn" aria-label="Auto-solve">Auto Solve</button>
            <button id="showSolutionBtn" aria-label="Show solution steps">Solution</button>
          </div>
        </div>
      </div>
    </section>

    <section class="daily-quote-section" aria-labelledby="quote-heading">
      <h2 id="quote-heading">üí° Daily Dose of Inspiration</h2>
      <div id="dailyQuoteDisplay" style="text-align:center;">
        <p id="motivationalQuote" style="font-size:clamp(1.1rem,4vw,1.4rem);font-weight:600;color:#38761d;margin-bottom:6px;"></p>
        <span id="quoteAuthor" style="display:block;font-style:italic;color:#6aa84f;"></span>
      </div>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:12px;">
        <button id="shuffleQuoteBtn" style="background:#6aa84f;color:white">Shuffle Quote</button>
        <button id="viewAllQuotesBtn" style="background:#5b8f3b;color:white">View All</button>
      </div>
    </section>
  </main>

  <!-- Image modal/carousel -->
  <div id="galleryModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content" role="document" tabindex="-1">
      <div class="nav left" id="navPrev" aria-label="Previous image" tabindex="0">&#10094;</div>
      <div class="nav right" id="navNext" aria-label="Next image" tabindex="0">&#10095;</div>
      <button class="close" id="galleryClose" aria-label="Close gallery">&times;</button>
      <img id="galleryImg" alt="">
      <div class="caption">
        <div id="galleryCaption">Caption</div>
        <div>
          <button id="galleryLike" class="like-btn" aria-pressed="false">‚ô°</button>
          <button id="galleryDownload" style="background:rgba(255,255,255,0.9);padding:6px;border-radius:8px;margin-left:8px;">Download</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Solution modal -->
  <div id="hanoiSolutionModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content" role="document" style="max-width:760px;padding:18px;">
      <button class="close" aria-label="Close solution">&times;</button>
      <h3 style="text-align:center;color:var(--color-primary);margin-top:0;">Optimal Solution (9 Moves)</h3>
      <table style="width:100%;border-collapse:collapse;margin-top:12px;">
        <thead><tr><th>Step</th><th>Disk</th><th>From</th><th>To</th></tr></thead>
        <tbody id="solutionBody"></tbody>
      </table>
    </div>
  </div>

  <button id="soundToggle" class="sound-toggle" aria-pressed="false" title="Toggle sound">üîä</button>

  <script>
  /* -------------------------------------
     Utilities & state
     ------------------------------------- */
  const mediaUrls = [
    {url:"./assets/RUCHITA_IMAGE_1.jpg", alt:"Ruchita smiling at the beach"},
    {url:"./assets/RUCHITA_IMAGE_2.jpg", alt:"Ruchita with friends"},
    {url:"./assets/RUCHITA_IMAGE_3.jpg", alt:"Ruchita candid moment"},
    {url:"./assets/RUCHITA_IMAGE_4.jpg", alt:"Ruchita during celebration"},
    {url:"./assets/RUCHITA_IMAGE_5.jpg", alt:"Ruchita laughing"},
    {url:"./assets/RUCHITA_IMAGE_6.jpg", alt:"Ruchita portrait"},
    {url:"./assets/RUCHITA_IMAGE_7.jpg", alt:"Ruchita and cake"},
    {url:"./assets/RUCHITA_IMAGE_8.jpg", alt:"Ruchita with friends at event"}
  ];

  /* ---------- 1) Memory wall with likes & gallery ---------- */
  const preview = document.getElementById('preview');
  const galleryModal = document.getElementById('galleryModal');
  const galleryImg = document.getElementById('galleryImg');
  const galleryCaption = document.getElementById('galleryCaption');
  const galleryLike = document.getElementById('galleryLike');
  const galleryClose = document.getElementById('galleryClose');
  const navPrev = document.getElementById('navPrev');
  const navNext = document.getElementById('navNext');
  const galleryDownload = document.getElementById('galleryDownload');

  let currentIndex = 0;
  const likesKey = 'ruchita_photo_likes';
  let likes = JSON.parse(localStorage.getItem(likesKey) || '{}');

  function buildMemoryWall(){
    mediaUrls.forEach((m, i) => {
      const w = document.createElement('div');
      w.className = 'media-item';
      w.setAttribute('role','button'); w.tabIndex = 0;
      const img = document.createElement('img');
      img.src = m.url; img.alt = m.alt || 'Birthday photo'; img.loading = 'lazy';
      w.appendChild(img);
      const likeBtn = document.createElement('button');
      likeBtn.className = 'like-btn';
      likeBtn.innerHTML = likes[i] ? '‚ù§Ô∏è' : '‚ô°';
      if (likes[i]) likeBtn.classList.add('liked');
      likeBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        likes[i] = !likes[i];
        saveLikes();
        likeBtn.innerHTML = likes[i] ? '‚ù§Ô∏è' : '‚ô°';
        likeBtn.classList.toggle('liked', likes[i]);
      });
      w.appendChild(likeBtn);
      w.addEventListener('click', ()=> openGallery(i));
      w.addEventListener('keydown', e => { if (e.key==='Enter' || e.key===' ') openGallery(i); });
      preview.appendChild(w);
    });
  }
  function saveLikes(){ localStorage.setItem(likesKey, JSON.stringify(likes)); }

  function openGallery(idx){
    currentIndex = idx;
    const m = mediaUrls[idx];
    galleryImg.src = m.url;
    galleryImg.alt = m.alt || '';
    galleryCaption.textContent = m.alt || '';
    galleryLike.innerText = likes[idx] ? '‚ù§Ô∏è' : '‚ô°';
    galleryLike.classList.toggle('liked', !!likes[idx]);
    galleryLike.setAttribute('aria-pressed', !!likes[idx]);
    galleryModal.setAttribute('aria-hidden','false');
    galleryModal.querySelector('.modal-content').focus();
    // keyboard listeners
    document.addEventListener('keydown', galleryKeyHandler);
  }
  function closeGallery(){
    galleryModal.setAttribute('aria-hidden','true');
    document.removeEventListener('keydown', galleryKeyHandler);
  }
  function galleryKeyHandler(e){
    if (e.key === 'Escape') closeGallery();
    if (e.key === 'ArrowRight') showNextImage();
    if (e.key === 'ArrowLeft') showPrevImage();
  }
  function showNextImage(){
    currentIndex = (currentIndex + 1) % mediaUrls.length; openGallery(currentIndex);
  }
  function showPrevImage(){
    currentIndex = (currentIndex - 1 + mediaUrls.length) % mediaUrls.length; openGallery(currentIndex);
  }
  galleryClose.addEventListener('click', closeGallery);
  navNext.addEventListener('click', showNextImage);
  navPrev.addEventListener('click', showPrevImage);
  navNext.addEventListener('keydown', e=> { if(e.key==='Enter'||e.key===' ') showNextImage(); });
  navPrev.addEventListener('keydown', e=> { if(e.key==='Enter'||e.key===' ') showPrevImage(); });

  // like inside gallery
  galleryLike.addEventListener('click', ()=>{
    likes[currentIndex] = !likes[currentIndex];
    galleryLike.innerText = likes[currentIndex] ? '‚ù§Ô∏è':'‚ô°';
    galleryLike.classList.toggle('liked', likes[currentIndex]);
    galleryLike.setAttribute('aria-pressed', !!likes[currentIndex]);
    // update wall button
    const likeBtnOnWall = preview.children[currentIndex].querySelector('.like-btn');
    if (likeBtnOnWall) { likeBtnOnWall.innerHTML = likes[currentIndex] ? '‚ù§Ô∏è' : '‚ô°'; likeBtnOnWall.classList.toggle('liked', likes[currentIndex]); }
    saveLikes();
  });

  // download
  galleryDownload.addEventListener('click', ()=>{
    const link = document.createElement('a');
    link.href = mediaUrls[currentIndex].url;
    link.download = `ruchita-${currentIndex+1}`;
    document.body.appendChild(link); link.click(); link.remove();
  });

  // swipe support for mobile (simple)
  (function addSwipe(){
    let startX=0, startY=0, move=false;
    const mc = galleryModal.querySelector('.modal-content');
    mc.addEventListener('touchstart', e=>{ if(e.touches && e.touches[0]){ startX = e.touches[0].clientX; startY = e.touches[0].clientY; move=true; }});
    mc.addEventListener('touchmove', e=>{ if(!move) return; const dx = e.touches[0].clientX - startX; const dy = e.touches[0].clientY - startY; if(Math.abs(dx)>30 && Math.abs(dy)<60){ if(dx<0) showNextImage(); else showPrevImage(); move=false; }});
    mc.addEventListener('touchend', ()=> move=false);
  })();

  /* ---------- 2) Drive videos lazy-load ---------- */
  const driveVideoIds = ["1G7VcF6Tpow7YDj6aWl5QwYXX7XAmG-QC","1WbtDdChJbIwLrvc_4YpXz3IUyTool0kt","1gRbI7djlHEPO4cdKj5_D6JTBdqVEgfLq"];
  const videoEmbedsContainer = document.getElementById('videoEmbedsContainer');
  function setupDriveVideos(){
    driveVideoIds.forEach((id)=>{
      const wrapper = document.createElement('div'); wrapper.className='video-wrapper';
      const placeholder = document.createElement('div'); placeholder.className='video-placeholder'; placeholder.tabIndex=0; placeholder.textContent='Load Video';
      placeholder.dataset.id = id;
      wrapper.appendChild(placeholder);
      videoEmbedsContainer.appendChild(wrapper);
      placeholder.addEventListener('click', ()=> loadDrive(wrapper,id));
      placeholder.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' ') loadDrive(wrapper,id); });
    });

    // lazy load as they enter viewport
    const obs = new IntersectionObserver((entries, o)=>{
      entries.forEach(en=>{
        if(!en.isIntersecting) return;
        const ph = en.target.querySelector('.video-placeholder');
        if(ph){ loadDrive(en.target, ph.dataset.id); o.unobserve(en.target); }
      });
    }, {rootMargin:'200px'});
    document.querySelectorAll('.video-wrapper').forEach(w=> obs.observe(w));
  }
  function loadDrive(container, id){
    if(container.dataset.loaded==='true') return;
    const iframe = document.createElement('iframe');
    iframe.src = `https://drive.google.com/file/d/${id}/preview`;
    iframe.width='100%'; iframe.height='100%'; iframe.style.border='none';
    iframe.allow='autoplay; fullscreen';
    container.innerHTML=''; container.appendChild(iframe); container.dataset.loaded='true';
  }

  /* ---------- 3) Hanoi with drag & drop + touch + keyboard ---------- */
  const pegs = { A:[4,3,2,1], B:[], C:[], D:[] };
  let moves = 0, selected = null, sourcePeg = null, solved=false;
  const pegEls = { A:document.getElementById('peg-A'), B:document.getElementById('peg-B'), C:document.getElementById('peg-C'), D:document.getElementById('peg-D') };
  const hanoiMessage = document.getElementById('hanoiMessage'); const hanoiMoves = document.getElementById('hanoiMoves');
  const pegsContainer = document.getElementById('pegsContainer'); const resetBtn = document.getElementById('resetHanoiBtn');
  const undoBtn = document.getElementById('undoHanoiBtn'); const autoBtn = document.getElementById('autoSolveBtn');
  const solutionBtn = document.getElementById('showSolutionBtn'); const solutionModal = document.getElementById('hanoiSolutionModal');

  const moveHistory = [];
  const optimalMoves = [
    {disk:1, from:'A', to:'C'},
    {disk:2, from:'A', to:'B'},
    {disk:1, from:'C', to:'B'},
    {disk:3, from:'A', to:'D'},
    {disk:4, from:'A', to:'C'},
    {disk:3, from:'D', to:'C'},
    {disk:1, from:'B', to:'A'},
    {disk:2, from:'B', to:'D'},
    {disk:1, from:'A', to:'D'}
  ];

  // create disk elements
  const diskEls = {};
  function makeDisks(){
    for(let i=1;i<=4;i++){
      const d = document.createElement('div'); d.className='disk'; d.dataset.size = i;
      d.id = 'disk-'+i; diskEls[i] = d;
      d.draggable = true; d.style.width = (20 + i*20) + 'px'; // fallback width
      // pointer/touch handlers
      d.addEventListener('dragstart', diskDragStart);
      d.addEventListener('touchstart', diskTouchStart, {passive:false});
      d.addEventListener('touchmove', diskTouchMove, {passive:false});
      d.addEventListener('touchend', diskTouchEnd);
    }
  }

  // position update
  function renderHanoi(){
    // remove any disks from DOM
    Object.values(diskEls).forEach(d=> d.remove());
    // append per peg, bottom to top
    Object.keys(pegs).forEach(pegId=>{
      const peg = pegEls[pegId];
      pegs[pegId].forEach((diskSize, idx)=>{
        const el = diskEls[diskSize];
        // compute bottom: idx*24
        el.style.bottom = `${idx*26}px`;
        // center horizontally on peg: set left using parent width and element width
        // append to peg (peg acts as stacking container)
        peg.appendChild(el);
      });
    });
    hanoiMoves.textContent = `Moves: ${moves}`;
    // check solved
    if(pegs.D.length === 4 && !solved){
      solved = true; announceWin();
    }
  }

  function isValidMove(size, toPeg){
    const top = pegs[toPeg][pegs[toPeg].length-1];
    return !top || size < top;
  }

  // click-based selection for keyboard users
  function pegClick(evt){
    if(solved) return;
    const el = evt.currentTarget;
    const pid = el.dataset.peg;
    const src = pegs[pid];
    const top = src[src.length-1];
    // clear target-ready
    Object.values(pegEls).forEach(p=>p.classList.remove('target-ready'));
    if(!selected){
      if(src.length>0){
        selected = top; sourcePeg = pid;
        diskEls[top].classList.add('dragging');
        // highlight valid targets
        Object.keys(pegs).forEach(p=>{ if(p!==sourcePeg && isValidMove(selected,p)) pegEls[p].classList.add('target-ready'); });
        hanoiMessage.textContent = `Picked disk ${selected} from ${sourcePeg}. Choose a peg or drop.`;
      } else {
        hanoiMessage.textContent = `That peg is empty.`;
      }
    } else {
      // placing
      if(pid === sourcePeg){
        diskEls[selected].classList.remove('dragging'); selected = null; sourcePeg = null; hanoiMessage.textContent = `Deselected disk.`;
        return;
      }
      if(isValidMove(selected, pid)){
        pegs[sourcePeg].pop(); pegs[pid].push(selected);
        moveHistory.push({disk:selected, from:sourcePeg, to:pid});
        moves++; selected = null; sourcePeg = null;
        hanoiMessage.textContent = `Moved disk.`;
        Object.values(pegEls).forEach(p=>p.classList.remove('target-ready'));
        renderHanoi();
      } else {
        hanoiMessage.textContent = 'Invalid move.';
      }
    }
  }

  // drag & drop handlers (desktop)
  function diskDragStart(e){
    const disk = e.target;
    // allow only top disk
    const parentPeg = disk.parentElement;
    const pegId = parentPeg.dataset.peg;
    const top = pegs[pegId][pegs[pegId].length-1];
    if(String(top) !== disk.dataset.size){
      e.preventDefault(); return;
    }
    e.dataTransfer.setData('text/plain', disk.dataset.size);
    // small drag ghost hack
    disk.classList.add('dragging');
    e.dataTransfer.effectAllowed = 'move';
  }
  function pegDragOver(e){ e.preventDefault(); e.dataTransfer.dropEffect='move'; }
  function pegDrop(e){
    e.preventDefault();
    if(solved) return;
    const size = Number(e.dataTransfer.getData('text/plain'));
    const destPeg = this.dataset.peg;
    // find source peg
    let srcPeg = null;
    Object.keys(pegs).forEach(p => { if(pegs[p][pegs[p].length-1] === size) srcPeg = p; });
    if(!srcPeg) return;
    if(destPeg === srcPeg) { diskEls[size].classList.remove('dragging'); return; }
    if(isValidMove(size, destPeg)){
      pegs[srcPeg].pop(); pegs[destPeg].push(size);
      moveHistory.push({disk:size, from:srcPeg, to:destPeg});
      moves++;
      diskEls[size].classList.remove('dragging');
      renderHanoi();
    } else {
      diskEls[size].classList.remove('dragging');
    }
  }

  // touch drag handlers (mobile)
  let touchDrag = {active:false, disk:null, startX:0, startY:0, originPeg:null};
  function diskTouchStart(e){
    e.preventDefault();
    const disk = e.target;
    const parentPeg = disk.parentElement;
    const pegId = parentPeg.dataset.peg;
    const top = pegs[pegId][pegs[pegId].length-1];
    if(String(top) !== disk.dataset.size) return;
    touchDrag.active = true; touchDrag.disk = disk; touchDrag.originPeg = pegId;
    disk.classList.add('dragging');
    touchDrag.startX = e.touches[0].clientX; touchDrag.startY = e.touches[0].clientY;
  }
  function diskTouchMove(e){
    if(!touchDrag.active) return;
    e.preventDefault();
    const touch = e.touches[0];
    const dx = touch.clientX - touchDrag.startX;
    const dy = touch.clientY - touchDrag.startY;
    touchDrag.disk.style.transform = `translate(${dx}px, ${dy}px) rotate(${dx*0.02}deg)`;
  }
  function diskTouchEnd(e){
    if(!touchDrag.active) return;
    // detect nearest peg from touch end
    const touch = e.changedTouches[0];
    const x = touch.clientX, y = touch.clientY;
    let nearest = null; let bestDist = Infinity;
    Object.keys(pegEls).forEach(pid=>{
      const rect = pegEls[pid].getBoundingClientRect();
      const cx = rect.left + rect.width/2, cy = rect.top + rect.height/2;
      const dist = Math.hypot(cx - x, cy - y);
      if(dist < bestDist){ bestDist = dist; nearest = pid; }
    });
    const size = Number(touchDrag.disk.dataset.size);
    // drop to nearest if valid & not same
    if(nearest && isValidMove(size, nearest) && nearest !== touchDrag.originPeg){
      pegs[touchDrag.originPeg].pop(); pegs[nearest].push(size);
      moveHistory.push({disk:size, from:touchDrag.originPeg, to:nearest});
      moves++;
      renderHanoi();
    } else {
      // revert visually
      touchDrag.disk.style.transform = '';
    }
    touchDrag.disk.classList.remove('dragging');
    touchDrag = {active:false, disk:null, startX:0, startY:0, originPeg:null};
  }

  // attach peg handlers
  function attachPegHandlers(){
    Object.keys(pegEls).forEach(pid=>{
      const el = pegEls[pid];
      el.addEventListener('click', pegClick);
      el.addEventListener('dragover', pegDragOver);
      el.addEventListener('drop', pegDrop);
      el.addEventListener('keydown', e => { if(e.key==='Enter' || e.key===' ') { pegClick({currentTarget:el}); } });
    });
  }

  function resetGame(){
    pegs.A = [4,3,2,1]; pegs.B=[]; pegs.C=[]; pegs.D=[];
    moves = 0; selected = null; sourcePeg = null; solved=false; moveHistory.length=0;
    hanoiMessage.textContent = 'Tap or press Enter/Space on a peg to pick or place a disk.';
    renderHanoi();
  }

  function undo(){
    const last = moveHistory.pop();
    if(!last) { hanoiMessage.textContent = 'No moves to undo.'; return; }
    pegs[last.to].pop(); pegs[last.from].push(last.disk); moves = Math.max(0, moves - 1);
    renderHanoi();
  }

  // auto-solve using optimalMoves with animation
  async function autoSolve(){
    resetGame();
    for(let m of optimalMoves){
      await new Promise(r => setTimeout(r, 500));
      pegs[m.from].pop(); pegs[m.to].push(m.disk); moves++; moveHistory.push(m);
      renderHanoi();
    }
  }

  // announce win: confetti burst and sound
  const soundToggle = document.getElementById('soundToggle');
  let soundOn = JSON.parse(localStorage.getItem('r_sound_on') || 'true');
  soundToggle.setAttribute('aria-pressed', soundOn);
  soundToggle.textContent = soundOn ? 'üîä' : 'üîà';
  soundToggle.addEventListener('click', ()=> { soundOn = !soundOn; localStorage.setItem('r_sound_on', JSON.stringify(soundOn)); soundToggle.textContent = soundOn ? 'üîä' : 'üîà'; });

  // small base64 beep/perk for win (short)
  const winSound = new Audio('data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAA...'); // placeholder (replace with real base64 chunk or file URL)
  function announceWin(){
    hanoiMessage.textContent = `üéâ You Win! Solved in ${moves} moves!`;
    // confetti burst
    burstConfetti();
    if(soundOn) { try { winSound.currentTime = 0; winSound.play(); } catch(e){} }
  }

  /* ---------- Confetti burst (bigger) ---------- */
  (function confettiEngine(){
    const canvas = document.getElementById('confettiCanvas'); if(!canvas) return;
    const ctx = canvas.getContext('2d'); let W=0,H=0; function resize(){ W=canvas.width=canvas.offsetWidth; H=canvas.height=canvas.offsetHeight; }
    window.addEventListener('resize', resize); resize();
    const particles = [];
    function createBurst(x,y){
      for(let i=0;i<80;i++){
        particles.push({x,y,vx:(Math.random()-0.5)*8,vy:(Math.random()-2.5)*8, r:2+Math.random()*5, rot:Math.random()*6, vr:(Math.random()-0.5)*0.2, life:80+Math.random()*40, col: `hsl(${Math.random()*360},80%,60%)`});
      }
    }
    function tick(){
      ctx.clearRect(0,0,W,H);
      for(let i=particles.length-1;i>=0;i--){
        const p=particles[i];
        p.x+=p.vx; p.y+=p.vy; p.vy+=0.18; p.rot+=p.vr; p.life--;
        ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
        ctx.fillStyle = p.col; ctx.fillRect(-p.r/2,-p.r/2,p.r*2,p.r);
        ctx.restore();
        if(p.life<0 || p.y>H+50) particles.splice(i,1);
      }
      requestAnimationFrame(tick);
    }
    tick();
    window.burstConfetti = (x,y) => {
      const reduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches; if(reduced) return;
      createBurst(x || canvas.width/2, y || canvas.height/2);
    };
  })();

  /* ---------- 4) Gallery & UI init ---------- */
  document.addEventListener('DOMContentLoaded', ()=>{
    buildMemoryWall(); setupDriveVideos(); makeDisks(); attachPegHandlers(); renderHanoi();
    // buttons
    resetBtn.addEventListener('click', resetGame);
    undoBtn.addEventListener('click', undo);
    autoBtn.addEventListener('click', autoSolve);
    solutionBtn.addEventListener('click', ()=> { // show solution modal table
      const solBody = document.getElementById('solutionBody'); solBody.innerHTML = '';
      optimalMoves.forEach((m,i)=>{ const row = document.createElement('tr'); row.innerHTML = `<td>${i+1}</td><td>${m.disk}</td><td>${m.from}</td><td>${m.to}</td>`; solBody.appendChild(row); });
      const sm = document.getElementById('hanoiSolutionModal'); sm.setAttribute('aria-hidden','false'); document.addEventListener('keydown', solutionKeyHandler);
    });
    // close solution modal
    document.querySelectorAll('#hanoiSolutionModal .close').forEach(b=> b.addEventListener('click', ()=> { document.getElementById('hanoiSolutionModal').setAttribute('aria-hidden','true'); document.removeEventListener('keydown', solutionKeyHandler); }));
    function solutionKeyHandler(e){ if(e.key==='Escape') { document.getElementById('hanoiSolutionModal').setAttribute('aria-hidden','true'); document.removeEventListener('keydown', solutionKeyHandler); } }

    // close gallery by background or Esc (already keyboard handled)
    galleryModal.addEventListener('click', (e)=>{ if(e.target === galleryModal) closeGallery(); });
    // close gallery close btn wired earlier
    document.getElementById('galleryClose').addEventListener('click', closeGallery);

    // persist likes loaded earlier into variable
    likes = JSON.parse(localStorage.getItem('ruchita_photo_likes') || '{}');
    // ensure likes length matches
    for(let i=0;i<mediaUrls.length;i++) if(likes[i] === undefined) likes[i] = false;
    saveLikes();

    // preload small images for smoother gallery nav
    mediaUrls.forEach(m=> { const im = new Image(); im.src = m.url; });

    // Allow clicking outside gallery modal to close
    document.querySelectorAll('.modal').forEach(mod=> mod.addEventListener('click', (e)=> { if(e.target === mod) mod.setAttribute('aria-hidden','true'); }));

    // sound toggle persisted above
    // small throttle: update storage on like changes
    setInterval(()=> localStorage.setItem('ruchita_photo_likes', JSON.stringify(likes)), 2000);
  });

  // gallery nav touch/keyboard support wired earlier

  // helper to play small click sound on interactions (optional)
  function playClick(){ if(soundOn) { try { winSound.currentTime = 0; winSound.play(); } catch(e){} } }

  </script>
</body>
</html>
